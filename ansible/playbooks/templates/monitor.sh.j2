# =============================================================================
# ANSIBLE/PLAYBOOKS/TEMPLATES/MONITOR.SH.J2 - Template monitoring
# =============================================================================
#!/bin/bash
# Script de monitoring Ansible Fode-DevOps

echo "================================================"
echo "üöÄ FODE-DEVOPS ANSIBLE MONITORING SYSTEM"
echo "================================================"
echo "Projet: {{ project_name }}-{{ environment }}"
echo "Serveur: {{ inventory_hostname }}"
echo "Date: $(date)"
echo "G√©r√© par: Ansible + Terraform"
echo "================================================"

echo ""
echo "üìä INFORMATIONS SYST√àME:"
echo "Hostname: $(hostname)"
echo "OS: $(cat /etc/os-release | grep PRETTY_NAME | cut -d'=' -f2 | tr -d '\"')"
echo "Kernel: $(uname -r)"
echo "Uptime: $(uptime | cut -d',' -f1 | cut -d' ' -f4-)"

echo ""
echo "üíæ M√âMOIRE:"
free -h

echo ""
echo "üíø STOCKAGE:"
df -h /

echo ""
echo "üî• CPU:"
echo "Load Average: $(cat /proc/loadavg | cut -d' ' -f1-3)"
echo "CPU Usage: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"

echo ""
echo "üåê R√âSEAU:"
echo "IP Priv√©e: $(curl -s http://169.254.169.254/latest/meta-data/local-ipv4 2>/dev/null || echo 'N/A')"
echo "IP Publique: $(curl -s http://169.254.169.254/latest/meta-data/public-ipv4 2>/dev/null || echo 'N/A')"

echo ""
echo "üîÑ SERVICES:"
systemctl is-active httpd >/dev/null && echo "‚úÖ Apache: Active" || echo "‚ùå Apache: Inactive"
systemctl is-active sshd >/dev/null && echo "‚úÖ SSH: Active" || echo "‚ùå SSH: Inactive"

echo ""
echo "üì¶ PACKAGES INSTALL√âS (derniers):"
dnf list installed | grep -E "(git|curl|htop|nodejs)" | head -5

echo ""
echo "üè∑Ô∏è TAGS AWS:"
aws ec2 describe-tags --region {{ aws_region }} --filters "Name=resource-id,Values={{ instance_id }}" --query 'Tags[*].[Key,Value]' --output table 2>/dev/null || echo "Impossible de r√©cup√©rer les tags"

echo ""
echo "================================================"
echo "‚úÖ Monitoring termin√© - Infrastructure Fode-DevOps"
echo "================================================"
